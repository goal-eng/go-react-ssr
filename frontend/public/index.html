<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{index . "title"}}</title>
    {{range $k, $v := index . "metaTags"}}
    <meta name="{{$k}}" content="{{$v}}" />
    {{end}} {{range $k, $v := index . "ogMetaTags"}}
    <meta property="{{$k}}" content="{{$v}}" />
    {{end}}
    <link rel="icon" type="image/svg+xml" href="/react.svg" />
  </head>
  <body>
    <div id="root"></div>
    <style>
      {{index . "css"}}}
    </style>
    <script>
      function showError(error) {
        document.getElementById(
          "root"
        ).innerHTML = `<div style="font-family: Helvetica; padding: 4px 16px"> <h1>An error occured</h1> <p style="color: red">${error}</p> </div>`;
      }
    </script>
    <script type="module">
      try{
        {{index . "src"}}
      } catch (e) {
        showError(e.stack)
      }
    </script>
    <script>
      let socket = new WebSocket("ws://127.0.0.1:8080/ws/hotreload");
      socket.onopen = () => {
        socket.send({{index . "route"}});
      };

      socket.onmessage = (event) => {
        if (event.data === "reload") {
          console.log("Change detected, reloading...");
          window.location.reload();
        }
      };

      // socket.onclose = (event) => {
      //   socket.send("Client Closed!");
      // };

      // socket.onerror = (error) => {};
    </script>
  </body>
</html>
